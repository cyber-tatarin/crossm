<!DOCTYPE html>
{% load static %}


{{seen}}

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
         <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <title>Document</title>
    </head>
    <body>

    {% include "base.html" %}

{% block content %}
{% if owner %}

        <main class="main">
            <div class="container-padding">
            <div class="container-main">
                <div class="profile">
                    <div class="profile-user">
                        <div class="profile-user-left">
                            <div class="profile-user__logo"></div>
                        </div>
                        <div class="profile-user-right">
                            <h1 class="profile-user__name">{{user.first_name}} {{user.last_name}}</h1>
                            <div class="city-info">
                                <span class="profile-user__city">Город:&nbsp</span>
                                <span class="profile-user__city__name">
                                    {% if user.profile_set.all.0.city.city %}
                                    {{user.profile_set.all.0.city.city}}
                                    {% else %}
                                    -
                                    {% endif %}
                                </span>
                            </div>
                            <div class="profile-user__buttons">
                                <div class="button-240px">
                                    <button class="button" onclick="window.location.href = '{% url 'update-profile' %}'">
                                        <p class="button-p">Редактировать профиль</p>
                                    </button>
                                </div>
                                <div class="button-240px">
                                    <button class="button" type="submit">
                                        <p class="button-p">Настройки</p>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-contacts">
                        <h2 class="profile-contacts__title">Контакты</h2>
                        <div class="profile-user__mail">
                            <p class="user__mail">{{user.email}}</p>
                        </div>
                        {% if user.profile_set.all.0.phone_num_show %}
                        <div class="profile-user__phone">
                            <p class="user__phone">{{user.profile_set.all.0.phone_num}}</p>
                            <div class="user__phone__logo"></div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <section>

                    <div class="container">
                        <h2 class="main-title profile-title">
                            Компании
                        </h2>
                        <div class="card-container">

                            {% for company in user.companies_set.all %}

                        <div class="card" id="company-{{company.id}}">
                            <div class="card-info">
                                <div class="card__logo"></div>
                                <div class="card__info">
                                    <h3 class="company-name">{{company.title}}</h3>
                                    <div class="company-title">
                                        <span class="company-sphere">Ниша:&nbsp</span>
                                        <span class="company-sphere-name">{{company.niche}}</span>
                                    </div>
                                    <div class="company-title company-title-12px">
                                        <span class="company-position">Должность в компании:&nbsp</span>
                                        {% if company.role %}
                                        <span class="company-position-name">{{company.role}}</span>
                                        {% else %}
                                        <span class="company-position-name">-</span>
                                        {% endif %}
                                    </div>

                                    {% if company.link %}
                                    <a style="margin-bottom: 28;" href="{{company.link}}" class="company-link">{{company.link}}</a>
                                    {% else %}
                                    <a href="{% url 'companies:company-page' company.id %}" class="company-link">{% url 'companies:company-page' company.id %}</a>
                                    {% endif %}

                                </div>
                                <div class="card-reviews">
                                    <span class="reviews-count">Отзывы(7)</span>
                                    <div class="rating-mini">
                                        <span class="active"></span>
                                        <span class="active"></span>
                                        <span class="active"></span>
                                        <span class="not-active"></span>
                                        <span class="not-active"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-user__buttons profile-user__buttons__gap-12px">
                            <div class="button-278px">
                                <button class="button button-long" onclick="window.location.href = '{% url 'companies:update-company' company.id %}'">
                                    <p class="button-p">Редактировать компанию</p>
                                </button>
                            </div>
                            <div class="button-278px">
                                <button class="button button-long" onclick="deleteUser({{company.id}})">
                                    <p class="button-p">Удалить компанию</p>
                                </button>
                            </div>
                            </div>
                        </div>

                            {% endfor %}

                        </div>

                    </div>
                </section>

            </div>
        </div>
        </main>

    {% else %}

        <main class="main">
            <div class="container-padding">
            <div class="container-main">
                <div class="profile">
                    <div class="profile-user">
                        <div class="profile-user-left">
                            <div class="profile-user__logo"></div>
                        </div>
                        <div class="profile-user-right">
                            <h1 class="profile-user__name">{{user.first_name}} {{user.last_name}}</h1>
                            <div class="city-info">
                                <span class="profile-user__city">Город:&nbsp</span>
                                <span class="profile-user__city__name">
                                    {% if user.profile_set.all.0.city.city %}
                                    {{user.profile_set.all.0.city.city}}
                                    {% else %}
                                    -
                                    {% endif %}
                                </span>
                            </div>
                            <div class="profile__remark">
                                {% if user.profile_set.all.0.bio %}
                                {{user.profile_set.all.0.bio}}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="profile-contacts">
                        <h2 class="profile-contacts__title">Контакты</h2>
                        <div class="profile-user__mail">
                            <p class="user__mail">{{user.email}}</p>
                        </div>
                        {% if user.profile_set.all.0.phone_num_show %}
                        <div class="profile-user__phone">
                            <p class="user__phone">{{user.profile_set.all.0.phone_num}}</p>
                            <div class="user__phone__logo"></div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <section>

                    <div class="container">
                        <h2 class="main-title profile-title">
                            Компании
                        </h2>
                        <div class="card-container">

                            {% for company in user.companies_set.all %}

                        <div class="card">
                            <div class="card-info">
                                <div class="card__logo"></div>
                                <div class="card__info">
                                    <h3 class="company-name">{{company.title}}”</h3>
                                    <div class="company-title">
                                        <span class="company-sphere">Ниша:&nbsp</span>
                                        <span class="company-sphere-name">{{company.niche}}</span>
                                    </div>
                                    <div class="company-title company-title-12px">
                                        <span class="company-position">Должность в компании:&nbsp</span>
                                        {% if company.role %}
                                        <span class="company-position-name">{{company.role}}</span>
                                        {% else %}
                                        <span class="company-position-name">-</span>
                                        {% endif %}
                                    </div>
                                    {% if company.link %}
                                    <a href="{{company.link}}" class="company-link">{{company.link}}</a>
                                    {% else %}
                                    <a href="{% url 'companies:company-page' company.id %}" class="company-link">{% url 'companies:company-page' company.id %}</a>
                                    {% endif %}
                                </div>
                                <div class="card-reviews">
                                    <span class="reviews-count">Отзывы(7)</span>
                                    <div class="rating-mini">
                                        <span class="active"></span>
                                        <span class="active"></span>
                                        <span class="active"></span>
                                        <span class="not-active"></span>
                                        <span class="not-active"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                            {% endfor %}

                        </div>
                    </div>


                </section>
            </div>
            </div>
        </main>
        <!-- <div class="bottom-margin"></div> -->

    {% endif %}

        {% include "footer.html" %}
        <!-- <div class="bottom-margin"></div> -->

    <script>
function deleteUser(id)
{
  var action = confirm("Are you sure you want to delete this user?");
  if (action != false)
  {
    $.ajax(
    {
        url: '{% url "companies:delete-company" %}',
        data: {
            'id': id,
             'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        dataType: 'json',
        success: function(data) {
              $("#company-" + id).remove();
        },
        type: "POST",

    });
  }
}
</script>

    </body>
{% endblock %}
</html>
